<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no"/><link rel="shortcut icon" href="/favicon.ico" /><title>Webpack 异步按需加载 - Xheldon</title><meta name="author" content="Xheldon" /><meta name="description" content="Webpack 异步按需加载" /><meta name="keywords" content="Webpack 异步按需加载, Xheldon, Framework" /><link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"><meta content="" property="fb:app_id"><meta content="Xheldon" property="og:site_name"><meta content="Webpack 异步按需加载" property="og:title"><meta content="article" property="og:type"><meta content="会点前端，在学 Node、Electron、ProseMirror" property="og:description"><meta content="https://xheldon.com/tech/webpack-details-one.html" property="og:url"><meta content="2016-05-02T15:23:12+00:00" property="article:published_time"><meta content="https://xheldon.com/about/" property="article:author"><meta content="/resource/img/logo_min.png" property="og:image"><meta content="Framework" property="article:section"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@"><meta name="twitter:creator" content="@"><meta name="twitter:title" content="Webpack 异步按需加载"><meta name="twitter:url" content="https://xheldon.com/tech/webpack-details-one.html"><meta name="twitter:description" content="会点前端，在学 Node、Electron、ProseMirror"><style type="text/css"> /* Project Elements */ .project-outer { display: inline-block; min-width: 30%; max-width: 45%; vertical-align: top; margin: 0 1.6%; overflow: hidden; } .project-img img { width: 100%; } h3.project-headlines { margin: 5px 0; font-size: 20px; } span.tags { font-size: 10px; border-bottom: 1px #888 dotted; margin: 0 5px; } span.tags:first-child { margin-left: 0; } span.tags:last-child { margin-right: 0; } .project-footer { clear: both; display: inline-block; width: 100%; } .project-footer .project-link { display: inline-block; position: relative; float: left; text-decoration: none; } .project-footer .project-timeline { display: inline-block; position: relative; float: right; font-size: 13px; font-style: italic; } .project-inner>a { display: block; } .project-img { width: 100%; height: 200px; display: block; background-size: contain; background-repeat: no-repeat; background-position: center center; } /** Project Tag Filters **/ .tag-group { margin: 0 0 25px 0; } span.tag-cloud { margin: 0 2px; cursor: pointer; font-size: 75%; padding: .2em .6em .3em; font-weight: 700; display: inline; } .tag-cloud.active { background: #ccc; } .project-item.not-show { display: none; } a.project-detail:hover { text-decoration: none; } a.project-detail:hover h3 { color: #428bca; }</style><link rel="stylesheet" href="/resource/css/main.css?t=20190911161844"><body><div class="container" id="container-post"><header id="header-post"> <a href="/"><img class="profile-avatar" src="/resource/img/logo_min.png" height="75px" width="75px" /></a><nav class="navlinks"><li><a class="about" href="https://42.xheldon.com/about/">我</a><li><a class="about" href="/book-list/">书单</a><li><a class="about" href="/projects/">项目</a><li><a class="about" href="/donate/">赞赏</a><li><a class="about" href="/feed.xml">订阅</a></nav><div class="search" id="js-search"> <input type="text" placeholder="搜索一下" class="search__input form-control" id="js-search__input"><ul class="search__results" id="js-search__results"></ul></div></header><main class="main-layout" id="page-post"><aside id="toc"><ul id="my_toc"><li><a href="#前言">前言</a><li><a href="#正文">正文</a><li><a href="#commonjs-和-amd-require-时候的区别"><em><code class="language-plaintext highlighter-rouge">CommonJS</code></em> 和 <em><code class="language-plaintext highlighter-rouge">AMD</code></em> <code class="language-plaintext highlighter-rouge">require</code> 时候的区别</a><li><a href="#chunk-打包优化策略"><code class="language-plaintext highlighter-rouge">chunk</code> 打包优化策略</a><li><a href="#补充-chunk-概念和定义">补充: <code class="language-plaintext highlighter-rouge">chunk</code> 概念和定义</a></ul></aside><article class="post"><section class="post-header"><h1 class="post-title">Webpack 异步按需加载</h1><div> <time class="time">2016年05月02日</time> <span class="categories"> &raquo; <a href="/category/Framework">Framework</a> </span></div></section><div class="time-tips">注意：离本文创建时间已经过去了 <code>1892</code> 天, 请注意时效性</div><h2 id="前言">前言</h2><p>webpack 想要实现异步加载, 即先加载主要模块, 用到某个模块或者多个模块(也即打包后的 chunk )的时候再发送请求加载.<p>这样做的目的当然是加快页面的初次加载速度, 但不可避免的会发送额外的请求, 这两个本身就是个鱼与熊掌不可兼得的事情, 这里说一下异步加载的细节.<h2 id="正文">正文</h2><p>实现主要是靠 <code class="language-plaintext highlighter-rouge">require.ensure([], callback)</code> 这个东西, 老实说我会注意到这个东西是因为在 <code class="language-plaintext highlighter-rouge">webpack.config.js</code> 的 <code class="language-plaintext highlighter-rouge">output</code> 字段有一个字段叫做 <code class="language-plaintext highlighter-rouge">chunkFilename</code>, 我这个打破沙锅的毛病就不得不想看看这个和 <code class="language-plaintext highlighter-rouge">filename</code> 字段有什么区别, 搜索了一下发现 <code class="language-plaintext highlighter-rouge">filename</code> (假设是 <code class="language-plaintext highlighter-rouge">bundle.js</code>) 是把页面需要的所有 <code class="language-plaintext highlighter-rouge">js</code> 打包, 最终生成的总的 <code class="language-plaintext highlighter-rouge">js</code> (当然多页面的时候可以提取公共模块, 这个不是本次的重点). 而 <code class="language-plaintext highlighter-rouge">chunkFilename</code> 是那些非入口点(<code class="language-plaintext highlighter-rouge">entry</code> 中列举的字段)的 <code class="language-plaintext highlighter-rouge">chunk</code> 文件打包生成的文件, 主要使用在按需异步加载模块的时候.<p>这些文件没有打包在 <code class="language-plaintext highlighter-rouge">bundle.js</code> 中, 而且只被部分(非全部的)模块依赖, 同时又需要异步加载, 因此就会通过使用 <code class="language-plaintext highlighter-rouge">require.ensure</code> 被打包到额外的 <code class="language-plaintext highlighter-rouge">js</code> 中, 而这些 <code class="language-plaintext highlighter-rouge">js</code>, 仍然是通过最终的 <code class="language-plaintext highlighter-rouge">bundle.js</code> 创建 <code class="language-plaintext highlighter-rouge">script</code> 标签, 然后被 <code class="language-plaintext highlighter-rouge">append</code> 到页面中的:<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// This file contains only the entry chunk.</span>
<span class="c1">// The chunk loading function for additional chunks</span>
<span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">e</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">requireEnsure</span><span class="p">(</span><span class="nx">chunkId</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// "0" is the signal for "already loaded"</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">__webpack_require__</span><span class="p">);</span>

  <span class="c1">// an array means "currently loading".</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// start chunk loading</span>
    <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">callback</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">head</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">'</span><span class="s1">head</span><span class="dl">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">script</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">text/javascript</span><span class="dl">'</span><span class="p">;</span>
    <span class="nx">script</span><span class="p">.</span><span class="nx">charset</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">;</span>
    <span class="nx">script</span><span class="p">.</span><span class="k">async</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">p</span> <span class="o">+</span> <span class="dl">""</span> <span class="o">+</span> <span class="p">({}[</span><span class="nx">chunkId</span><span class="p">]</span><span class="o">||</span><span class="nx">chunkId</span><span class="p">)</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">.js</span><span class="dl">"</span><span class="p">;</span>
    <span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div><p>OK, 这些理解起来都很容易, 但是查看 <a href="http://webpack.github.io/docs/code-splitting.html#defining-a-split-point">官方文档</a> 的时候, 发现了几个需要注意的细节.<h2 id="commonjs-和-amd-require-时候的区别"><em><code class="language-plaintext highlighter-rouge">CommonJS</code></em> 和 <em><code class="language-plaintext highlighter-rouge">AMD</code></em> <code class="language-plaintext highlighter-rouge">require</code> 时候的区别</h2><p><code class="language-plaintext highlighter-rouge">CommonJS</code> 是使用 <code class="language-plaintext highlighter-rouge">require.ensure([''], callback)</code> 来处理异步加载模块的, <code class="language-plaintext highlighter-rouge">AMD</code> 是和一般的 <code class="language-plaintext highlighter-rouge">AMD</code> 模块一样, 使用 <code class="language-plaintext highlighter-rouge">require</code> 一个数组依赖的形式处理的 <code class="language-plaintext highlighter-rouge">require([''], callback)</code><p>但是 <code class="language-plaintext highlighter-rouge">CommonJS</code> 加载数组中模块的时候, 是只加载不执行, 除非是在 <code class="language-plaintext highlighter-rouge">callback</code> 中, 又 <code class="language-plaintext highlighter-rouge">require</code> 了一遍才执行:<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">require</span><span class="p">([</span><span class="dl">'</span><span class="s1">./other/ensure.js</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">./other/ensure2.js</span><span class="dl">'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">ensure</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./other/ensure.js</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">ensure2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./other/ensure2.js</span><span class="dl">'</span><span class="p">);</span>

  <span class="nx">module1</span><span class="p">();</span>
  <span class="nx">module2</span><span class="p">();</span>
<span class="p">},</span> <span class="nx">chunkFilename</span><span class="p">);</span>
</code></pre></div></div><blockquote><p>The require.ensure method ensures that every dependency in dependencies can be synchronously required when calling the callback. An implementation of the require function is sent as a parameter to the callback.</blockquote><p>而且这个 <code class="language-plaintext highlighter-rouge">callback</code> 的参数, 是一个实现了 <code class="language-plaintext highlighter-rouge">require</code> 接口的函数(没错的话应该只是一个 <code class="language-plaintext highlighter-rouge">require</code> 函数的引用);<p>这个 <code class="language-plaintext highlighter-rouge">chunkFilename</code> 会被 <code class="language-plaintext highlighter-rouge">output</code> 中的 <code class="language-plaintext highlighter-rouge">chunkFilename</code> 设置覆盖.<p>而 <code class="language-plaintext highlighter-rouge">AMD</code> 因为是正常一贯的依赖前置, 所以其会在 <code class="language-plaintext highlighter-rouge">require</code> 的时候就执行模块:<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">require</span><span class="p">([</span><span class="dl">'</span><span class="s1">./other/ensure.js</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">./other/ensure2.js</span><span class="dl">'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ensure</span><span class="p">,</span> <span class="nx">ensure2</span><span class="p">){</span>
  <span class="nx">ensure</span><span class="p">();</span>
  <span class="nx">ensure2</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div><p>OK, <code class="language-plaintext highlighter-rouge">AMD</code> 的例子不熟, 下面以 <code class="language-plaintext highlighter-rouge">CommonJS</code> 为例说明一些细节.<p>首先, 如果给 <code class="language-plaintext highlighter-rouge">require.ensure</code> 传递一个 <code class="language-plaintext highlighter-rouge">callback</code> , 则在回调函数中 <code class="language-plaintext highlighter-rouge">require</code> 来的模块也会被全部打包到最终异步加载的文件中.<h2 id="chunk-打包优化策略"><code class="language-plaintext highlighter-rouge">chunk</code> 打包优化策略</h2><ol><li>如果两个 <code class="language-plaintext highlighter-rouge">chunk</code> 包含相同的模块, 那么他们将合并成一个.<li>如果一个模块在一个 <code class="language-plaintext highlighter-rouge">chunk</code> 的所有父级 <code class="language-plaintext highlighter-rouge">chunk</code> 都可用, 那么该模块将会在该 <code class="language-plaintext highlighter-rouge">chunk</code> 中被移除.<li>如果一个 <code class="language-plaintext highlighter-rouge">chunk</code> 包含了另一个 <code class="language-plaintext highlighter-rouge">chunk</code> 的所有模块, 那么最终将打包包含更多 <code class="language-plaintext highlighter-rouge">module</code> 的这个 <code class="language-plaintext highlighter-rouge">chunk</code>, 这个规则对一个 <code class="language-plaintext highlighter-rouge">chunk</code> 包含其他 多个 <code class="language-plaintext highlighter-rouge">chunk</code> 的所有 <code class="language-plaintext highlighter-rouge">module</code> 同样适用.</ol><p>其中第二条不好理解, 其实它所说的情况是, 在一个入口文件 <code class="language-plaintext highlighter-rouge">A.js</code> 中包含 <code class="language-plaintext highlighter-rouge">b</code> 模块, 而使用 <code class="language-plaintext highlighter-rouge">require.ensure</code> 打包生成了一个 <code class="language-plaintext highlighter-rouge">chunk.js</code> 文件中也包含这个 <code class="language-plaintext highlighter-rouge">b</code> 模块, 因为 <code class="language-plaintext highlighter-rouge">require.ensure</code> 是在 <code class="language-plaintext highlighter-rouge">A.js</code> 文件中调用的, 因此 <code class="language-plaintext highlighter-rouge">A.js</code> 算是这个 <code class="language-plaintext highlighter-rouge">chunk.js</code> 的父级 <code class="language-plaintext highlighter-rouge">chunk</code>, 那么最终打包生成的 <code class="language-plaintext highlighter-rouge">chunk.js</code> 中包含的 <code class="language-plaintext highlighter-rouge">b</code> 模块 内容将被移除. 而 <code class="language-plaintext highlighter-rouge">在所有父级 chunk 都可用</code> 指的是第一条所说的情况: 几个 <code class="language-plaintext highlighter-rouge">chunk</code> 包含相同的 <code class="language-plaintext highlighter-rouge">module</code>, 那么只会生成一个最终的 <code class="language-plaintext highlighter-rouge">bundle.js</code>, 但导致的可能是这个 <code class="language-plaintext highlighter-rouge">chunk</code> 存在多个父级 <code class="language-plaintext highlighter-rouge">chunk</code> (即 <code class="language-plaintext highlighter-rouge">entry</code> 对应的 <code class="language-plaintext highlighter-rouge">chunk</code> 文件).<p>验证一下:<p>入口文件 <code class="language-plaintext highlighter-rouge">app.js</code> 的代码:<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../other/if_be_remove.js</span><span class="dl">'</span><span class="p">)();</span>
<span class="nx">require</span><span class="p">.</span><span class="nx">ensure</span><span class="p">([</span><span class="dl">'</span><span class="s1">../other/ensure.js</span><span class="dl">'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span>
	<span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../other/ensure.js</span><span class="dl">'</span><span class="p">)();</span>
<span class="p">},</span> <span class="dl">'</span><span class="s1">love</span><span class="dl">'</span><span class="p">);</span>

</code></pre></div></div><p>另一个入口文件 <code class="language-plaintext highlighter-rouge">app2.js</code> 的代码:<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../other/if_be_remove.js</span><span class="dl">'</span><span class="p">)();</span>
<span class="nx">require</span><span class="p">.</span><span class="nx">ensure</span><span class="p">([</span><span class="dl">'</span><span class="s1">../other/ensure2.js</span><span class="dl">'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span>
	<span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../other/ensure2.js</span><span class="dl">'</span><span class="p">)();</span>
<span class="p">},</span> <span class="dl">'</span><span class="s1">hate</span><span class="dl">'</span><span class="p">);</span>

</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">ensure.js</code> 的代码:<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./if_be_remove.js</span><span class="dl">'</span><span class="p">)();</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">i</span><span class="se">\'</span><span class="s1">m be ensure!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">ensure2.js</code> 的代码:<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./if_be_remove.js</span><span class="dl">'</span><span class="p">)();</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">i</span><span class="se">\'</span><span class="s1">m be ensure2!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div><p>最后, 在子 <code class="language-plaintext highlighter-rouge">chunk</code> 和父级 <code class="language-plaintext highlighter-rouge">chunk</code> 都存在的 <code class="language-plaintext highlighter-rouge">if_be_remove.js</code> 的代码:<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">im be removed!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div><p>看下 <code class="language-plaintext highlighter-rouge">Chrome</code> 浏览器控制台中 <code class="language-plaintext highlighter-rouge">Network</code> 中加载的 <code class="language-plaintext highlighter-rouge">js</code> 的内容(这里使用 <code class="language-plaintext highlighter-rouge">[id].[name].js</code> 的命名方式)<p><code class="language-plaintext highlighter-rouge">app.js</code> 页面:<p><img src="https://cdn.jsdelivr.net/gh/xheldon/x_blog-static@master/img/2016/webpack-async-1.png" alt="webpack-async" title="webpack-async" /><p><code class="language-plaintext highlighter-rouge">app2.js</code> 页面<p><img src="https://cdn.jsdelivr.net/gh/xheldon/x_blog-static@master/img/2016/webpack-async-2.png" alt="webpack-async" title="webpack-async" /><p>可以看到, 因为 <code class="language-plaintext highlighter-rouge">if_be_remove.js</code> 在两个 <code class="language-plaintext highlighter-rouge">chunk</code> 中, 即 <code class="language-plaintext highlighter-rouge">1-love.js</code> 和 <code class="language-plaintext highlighter-rouge">3.hate.js</code> 被引用, 而同时又被这两个 <code class="language-plaintext highlighter-rouge">chunk</code> 的父级, 也即 <code class="language-plaintext highlighter-rouge">app.js</code> 和 <code class="language-plaintext highlighter-rouge">app2.js</code> 引用, 因此在这两个 <code class="language-plaintext highlighter-rouge">chunk</code> 中, 没有出现 <code class="language-plaintext highlighter-rouge">if_be_remove.js</code> 的代码.<h2 id="补充-chunk-概念和定义">补充: <code class="language-plaintext highlighter-rouge">chunk</code> 概念和定义</h2><p>这里再补充一下, 所谓 <code class="language-plaintext highlighter-rouge">chunk</code>, 指的是一个或者几个 <code class="language-plaintext highlighter-rouge">module</code> 组成的一个独立的 <code class="language-plaintext highlighter-rouge">js</code> 文件, 而 <code class="language-plaintext highlighter-rouge">chunk</code> 分为以下几个类型:<ol><li><code class="language-plaintext highlighter-rouge">Entry Chunks</code>: <code class="language-plaintext highlighter-rouge">Entry Chunks</code>是我们最常见的<code class="language-plaintext highlighter-rouge">Chunks</code>类型, 包含了我们自己写的业务逻辑相关代码(大多数情况下是独有的代码, 即不会被提取到公共 <code class="language-plaintext highlighter-rouge">chunks</code> 中的代码), 一般会等到 <code class="language-plaintext highlighter-rouge">Initial Chunks</code> 加载完成才会执行(或者是遇到 <code class="language-plaintext highlighter-rouge">module</code> 编号为 <code class="language-plaintext highlighter-rouge">0</code> 的 module).<li><code class="language-plaintext highlighter-rouge">Normal Chunks</code>: <code class="language-plaintext highlighter-rouge">Normal Chunks</code> 主要指代那些应用运行时动态加载的模块,<code class="language-plaintext highlighter-rouge">Webpack</code>会为我们创建类似于 <code class="language-plaintext highlighter-rouge">JSONP</code> 这样合适的加载器来进行动态加载.<li><code class="language-plaintext highlighter-rouge">Initial Chunks</code>: <code class="language-plaintext highlighter-rouge">Initial Chunks</code> 本质上还是 <code class="language-plaintext highlighter-rouge">Normal Chunks</code>, 不过其会在应用初始化时完成加载, 往往这个类型的<code class="language-plaintext highlighter-rouge">Chunks</code>由<code class="language-plaintext highlighter-rouge">CommonsChunkPlugin</code>生成, 这个这个里面包含了全局的模块位置信息, <code class="language-plaintext highlighter-rouge">Entry chunks</code> 中的代码执行依赖这个 <code class="language-plaintext highlighter-rouge">chunk</code>, 因此应该优先加载这个 <code class="language-plaintext highlighter-rouge">js</code>.</ol><p>在之前的举例中, 被打包成公共 <code class="language-plaintext highlighter-rouge">js</code> 供全部或者部分页面使用的的 <code class="language-plaintext highlighter-rouge">bundule.js</code> 是 <code class="language-plaintext highlighter-rouge">Initial Chunks</code>, 只在当前页面才会用到的<code class="language-plaintext highlighter-rouge"> chunk</code> 如 <code class="language-plaintext highlighter-rouge">app.xxxxxx.js</code> 是 <code class="language-plaintext highlighter-rouge">Entry Chunks</code>, 通过 <code class="language-plaintext highlighter-rouge">require.ensure</code> 异步加载的 <code class="language-plaintext highlighter-rouge">chunk</code> 如 <code class="language-plaintext highlighter-rouge">3-hate</code> <code class="language-plaintext highlighter-rouge">1-love</code> 是 <code class="language-plaintext highlighter-rouge">Normal Chunks</code>.</article><div class="page-footer"><hr /> 转载请<a href="/tech/webpack-details-one.html">注明出处</a>&nbsp;&nbsp;打赏请<a href="/donate/" target="_blank">移步这里</a> <br><br> <span class="EOF">- EOF -</span> <br><br><div class="panel-body"><h4>相同分类:</h4><ul><li class="relatedPost"> <a href="/tech/Collaborative-Editing-in-ProseMirror.html">[译]ProseMirror 中的协同编辑实现</a> (分类: <a href="/category/Framework">Framework</a>, <a href="/category/ProseMirror">ProseMirror</a>)<li class="relatedPost"> <a href="/tech/vue-reactive.html">Vue 响应式原理及实现</a> (分类: <a href="/category/Framework">Framework</a>)<li class="relatedPost"> <a href="/tech/three-ways-to-make-a-vue-SPA-use-router.html">Vue 实现路由的三种方式</a> (分类: <a href="/category/Framework">Framework</a>)<li class="relatedPost"> <a href="/tech/vue-learning-summary.html">Vue 学习总结</a> (分类: <a href="/category/Framework">Framework</a>)<li class="relatedPost"> <a href="/tech/vue-simple-use.html">Vue + Webpack 组件式开发(练习环境)初体验</a> (分类: <a href="/category/Framework">Framework</a>)</ul></div><div class="page-navigation"> <a class="prev" href="/tech/github-pages-config.html">&laquo; 关于本博客域名优化配置的几点说明</a> <a class="next" href="/tech/vue-simple-use.html">Vue + Webpack 组件式开发(练习环境)初体验 &raquo;</a></div><div id="gitalk-container"></div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script type="text/javascript"> window.addEventListener('load', function(){ var gitalk = new Gitalk({ clientID: 'd2b353a60fa1233163fc', clientSecret: '8091d57674976bcd60fc05261bf93c00da7e5ff4', repo: 'x_blog', owner: 'Xheldon', admin: ['Xheldon'], id: "webpack-details-one" }); gitalk.render('gitalk-container'); }); </script></main><footer> &copy; 2021 - Xheldon - Theme Powered By Xheldon <span class="footer-social"> <a href="https://twitter.com/_Xheldon" target="_blank"><i class="fab fa-twitter"></i></a> <a href="https://t.me/xheldon_saloon" target="_blank"><i class="fab fa-telegram"></i></a> <a href="https://www.zhihu.com/people/xheldon/pins" target="_blank"><i class="fa" style="font-size: 16px;line-height:2;">知乎</i></a> </span></footer></div><script type="text/javascript"> !function () { function e(t) { var n = {}; if (1 == t.nodeType) { if (t.attributes.length > 0) { n["@attributes"] = {}; for (var i = 0; i < t.attributes.length; i++) { var s = t.attributes.item(i); n["@attributes"][s.nodeName] = s.nodeValue } } } else 3 == t.nodeType && (n = t.nodeValue); var a = [].slice.call(t.childNodes).filter(function (e) { return 3 === e.nodeType }); if (t.hasChildNodes() && t.childNodes.length === a.length) n = [].slice.call(t.childNodes).reduce(function (e, t) { return e + t.nodeValue }, ""); else if (t.hasChildNodes()) for (var r = 0; r < t.childNodes.length; r++) { var o = t.childNodes.item(r), d = o.nodeName; if ("undefined" == typeof n[d]) n[d] = e(o); else { if ("undefined" == typeof n[d].push) { var c = n[d]; n[d] = [], n[d].push(c) } n[d].push(e(o)) } } return n } function t(t) { var n = e(t); return n.channel.item } var n, i = document.querySelector("#js-search"), s = document.querySelector("#js-search__input"), a = document.querySelector("#js-search__results"), r = "", o = [], d = new XMLHttpRequest; d.open("GET", "/sitemap.xml"), d.onreadystatechange = function () { if (4 == d.readyState && (200 == d.status || 304 == d.status)) { var e = (new DOMParser).parseFromString(d.responseText, "text/xml"); e = e.children[0], o = t(e) } }, d.send(), window.toggleSearch = function () { _gaq.push(["_trackEvent", "supersearch", i.classList.contains("is-active")]), i.classList.toggle("is-active"), i.classList.contains("is-active") ? s.value = "" : a.classList.add("is-hidden"), setTimeout(function () { s.focus() }, 210) }, window.addEventListener("keyup", function (e) { 27 === e.which && toggleSearch() }), window.addEventListener("keypress", function (e) { 47 !== e.which || i.classList.contains("is-active") || toggleSearch() }), s.addEventListener("input", function () { var e, t; if (r = (s.value + "").toLowerCase(), !r || r.length < 3) return n = "", void a.classList.add("is-hidden"); a.style.offsetWidth; var i; i = void 0 === o.title ? o.filter(function (e) { return -1 !== (e.title + "").toLowerCase().indexOf(r) || -1 !== (e.description + "").toLowerCase().indexOf(r) ? !0 : void 0 }) : [o], i.length || a.classList.add("is-hidden"), e = i.reduce(function (e, t) { return t.title + e }, ""), i.length && e !== n && (a.classList.remove("is-hidden"), a.innerHTML = i.map(function (e) { return t = new Date(e.pubDate), '<li><a href="' + e.link + '">' + e.title + "</a>" }).join("")), n = e }) }(); </script><link href="https://cdn.jsdelivr.net/gh/xheldon/x_blog-static@master/css/font-awesome.min.css" rel="stylesheet" crossorigin="anonymous"> <script> (function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-79359216-1', 'auto'); ga('send', 'pageview'); </script> <script> document.addEventListener('DOMContentLoaded',function(){ try { Array.prototype.slice.call(document.querySelectorAll('a')).forEach(function(a){ if (!a.getAttribute('target')) { let href = a.getAttribute('href'); let attrs = Object.keys(a.dataset); if (href && href.indexOf('/') && href.indexOf('#')) { a.setAttribute('target', '_blank'); } else { a.setAttribute('target', '_self'); } /* 默认情况下外链在新窗口打开, 本地链接在当前窗口打开 kramdown 可以对 url 设置特殊属性 data-open, 因此用此特性来排除需要在新窗口打开的本地链接 */ if (attrs.length) { attrs.forEach(function(attr){ switch (attr) { case 'open': a.setAttribute('target', '_blank'); break; default: break; } }); } } }); } catch (e) { console.log('新窗口打开链接失败:', e); } /*try { let toc = document.getElementById('post-toc'); if (toc) { function setPosition() { let offset = toc.parentElement.getBoundingClientRect().y; if (offset <= 50) { toc.style.position = 'fixed'; toc.style.top = '50px'; } else { toc.style.position = 'absolute'; toc.style.top = '0'; } } setPosition(); window.addEventListener('scroll', setPosition); } } catch(e) { console.log('toc滚动失败'); }*/ }); </script>
